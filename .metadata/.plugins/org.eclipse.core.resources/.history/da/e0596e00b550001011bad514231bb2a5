package com.stayfor.fileupload_service.controller;

import java.util.Iterator;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.multipart.MultipartHttpServletRequest;

@RestController
@RequestMapping
public class UploadController {
	private static final Logger logger = LoggerFactory.getLogger( UploadController.class );
	@PostMapping("/file/test")
	public String test(MultipartHttpServletRequest request) {
		Iterator<String> fileNames = request.getFileNames();
		
		if(!fileNames.hasNext()) {
			logger("업로드 파일이 없습니다.");
			return "파일없음";
		}
		while(fileNames.hasNext()) {
			String key = fileNames.next(); // "0", "1", etc. 또는 단일일 경우 하나뿐
            MultipartFile file = request.getFile(key);

            if (file != null && !file.isEmpty()) {
            	logger("Key: " + key);
            	logger("파일 이름: " + file.getOriginalFilename());
            	logger("파일 크기: " + file.getSize());
            	logger("Content-Type: " + file.getContentType());
            	logger("------------");
            }
		}
		return "업로드 완료";
	}
}
